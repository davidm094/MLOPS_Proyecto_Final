apiVersion: batch/v1
kind: Job
metadata:
  name: create-buckets
  namespace: mlops
  annotations:
    argocd.argoproj.io/hook: PostSync
    argocd.argoproj.io/hook-delete-policy: HookSucceeded
spec:
  template:
    spec:
      containers:
      - name: create-buckets
        image: amazon/aws-cli
        command: ["/bin/sh", "-c"]
        args:
        - |
          echo "Waiting for SeaweedFS S3..."
          sleep 10
          export AWS_ACCESS_KEY_ID=any
          export AWS_SECRET_ACCESS_KEY=any
          export AWS_ENDPOINT_URL=http://seaweedfs-s3.mlops.svc:8333
          
          # Create buckets
          aws s3 mb s3://mlflow-artifacts --endpoint-url $AWS_ENDPOINT_URL || true
          aws s3 mb s3://airflow-logs --endpoint-url $AWS_ENDPOINT_URL || true
          aws s3 mb s3://data-raw --endpoint-url $AWS_ENDPOINT_URL || true
          aws s3 mb s3://data-clean --endpoint-url $AWS_ENDPOINT_URL || true
          
          echo "Buckets created!"
      restartPolicy: OnFailure

